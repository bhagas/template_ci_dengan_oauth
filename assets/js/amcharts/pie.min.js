AmCharts.AmPieChart=AmCharts.Class({inherits:AmCharts.AmSlicedChart,construct:function(a){this.type="pie";AmCharts.AmPieChart.base.construct.call(this,a);this.cname="AmPieChart";this.pieBrightnessStep=30;this.minRadius=10;this.depth3D=0;this.startAngle=90;this.angle=this.innerRadius=0;this.startRadius="500%";this.pullOutRadius="20%";this.labelRadius=20;this.labelText="[[title]]: [[percents]]%";this.balloonText="[[title]]: [[percents]]% ([[value]])\n[[description]]";this.previousScale=1;AmCharts.applyTheme(this,a,this.cname)},drawChart:function(){AmCharts.AmPieChart.base.drawChart.call(this);var T=this.chartData;if(AmCharts.ifArray(T)){if(0<this.realWidth&&0<this.realHeight){AmCharts.VML&&(this.startAlpha=1);var S=this.startDuration,V=this.container,W=this.updateWidth();this.realWidth=W;var Q=this.updateHeight();this.realHeight=Q;var U=AmCharts.toCoordinate,P=U(this.marginLeft,W),X=U(this.marginRight,W),F=U(this.marginTop,Q)+this.getTitleHeight(),N=U(this.marginBottom,Q),C,o,R,D=AmCharts.toNumber(this.labelRadius),J=this.measureMaxLabel();J>this.maxLabelWidth&&(J=this.maxLabelWidth);this.labelText&&this.labelsEnabled||(D=J=0);C=void 0===this.pieX?(W-P-X)/2+P:U(this.pieX,this.realWidth);o=void 0===this.pieY?(Q-F-N)/2+F:U(this.pieY,Q);R=U(this.radius,W,Q);R||(W=0<=D?W-P-X-2*J:W-P-X,Q=Q-F-N,R=Math.min(W,Q),Q<W&&(R/=1-this.angle/90,R>W&&(R=W)),Q=AmCharts.toCoordinate(this.pullOutRadius,R),R=(0<=D?R-1.8*(D+Q):R-1.8*Q)/2);R<this.minRadius&&(R=this.minRadius);Q=U(this.pullOutRadius,R);F=AmCharts.toCoordinate(this.startRadius,R);U=U(this.innerRadius,R);U>=R&&(U=R-1);N=AmCharts.fitToBounds(this.startAngle,0,360);0<this.depth3D&&(N=270<=N?270:90);N-=90;W=R-R*this.angle/90;for(P=0;P<T.length;P++){if(X=T[P],!0!==X.hidden&&0<X.percents){var M=360*X.percents/100,J=Math.sin((N+M/2)/180*Math.PI),j=-Math.cos((N+M/2)/180*Math.PI)*(W/R),L=this.outlineColor;L||(L=X.color);var i=this.alpha;isNaN(X.alpha)||(i=X.alpha);L={fill:X.color,stroke:L,"stroke-width":this.outlineThickness,"stroke-opacity":this.outlineAlpha,"fill-opacity":i};X.url&&(L.cursor="pointer");L=AmCharts.wedge(V,C,o,N,M,R,W,U,this.depth3D,L,this.gradientRatio,X.pattern);this.addEventListeners(L,X);X.startAngle=N;T[P].wedge=L;0<S&&(this.chartCreated||L.setAttr("opacity",this.startAlpha));X.ix=J;X.iy=j;X.wedge=L;X.index=P;if(this.labelsEnabled&&this.labelText&&X.percents>=this.hideLabelsPercent){var O=N+M/2;360<O&&(O-=360);var H=D;isNaN(X.labelRadius)||(H=X.labelRadius);var M=C+J*(R+H),i=o+j*(R+H),K,E=0;if(0<=H){var I;90>=O&&0<=O?(I=0,K="start",E=8):90<=O&&180>O?(I=1,K="start",E=8):180<=O&&270>O?(I=2,K="end",E=-8):270<=O&&360>O&&(I=3,K="end",E=-8);X.labelQuarter=I}else{K="middle"}var O=this.formatString(this.labelText,X),G=this.labelFunction;G&&(O=G(X,O));G=X.labelColor;G||(G=this.color);O=AmCharts.wrappedText(V,O,G,this.fontFamily,this.fontSize,K,!1,this.maxLabelWidth);O.translate(M+1.5*E,i);O.node.style.pointerEvents="none";X.tx=M+1.5*E;X.ty=i;0<=H?(H=O.getBBox(),G=AmCharts.rect(V,H.width+5,H.height+5,"#FFFFFF",0.005),G.translate(M+1.5*E+H.x,i+H.y),X.hitRect=G,L.push(O),L.push(G)):this.freeLabelsSet.push(O);X.label=O;X.tx=M;X.tx2=M+E;X.tx0=C+J*R;X.ty0=o+j*R}M=U+(R-U)/2;X.pulled&&(M+=this.pullOutRadiusReal);X.balloonX=J*M+C;X.balloonY=j*M+o;X.startX=Math.round(J*F);X.startY=Math.round(j*F);X.pullX=Math.round(J*Q);X.pullY=Math.round(j*Q);this.graphsSet.push(L);(0===X.alpha||0<S&&!this.chartCreated)&&L.hide();N+=360*X.percents/100}}0<D&&!this.labelRadiusField&&this.arrangeLabels();this.pieXReal=C;this.pieYReal=o;this.radiusReal=R;this.innerRadiusReal=U;0<D&&this.drawTicks();this.initialStart();this.setDepths()}(T=this.legend)&&T.invalidateSize()}else{this.cleanChart()}this.dispDUpd();this.chartCreated=!0},setDepths:function(){var g=this.chartData,d;for(d=0;d<g.length;d++){var h=g[d],a=h.wedge,h=h.startAngle;0<=h&&180>h?a.toFront():180<=h&&a.toBack()}},arrangeLabels:function(){var g=this.chartData,d=g.length,h,a;for(a=d-1;0<=a;a--){h=g[a],0!==h.labelQuarter||h.hidden||this.checkOverlapping(a,h,0,!0,0)}for(a=0;a<d;a++){h=g[a],1!=h.labelQuarter||h.hidden||this.checkOverlapping(a,h,1,!1,0)}for(a=d-1;0<=a;a--){h=g[a],2!=h.labelQuarter||h.hidden||this.checkOverlapping(a,h,2,!0,0)}for(a=0;a<d;a++){h=g[a],3!=h.labelQuarter||h.hidden||this.checkOverlapping(a,h,3,!1,0)}},checkOverlapping:function(n,l,p,q,j){var o,i,r=this.chartData,s=r.length,g=l.label;if(g){if(!0===q){for(i=n+1;i<s;i++){r[i].labelQuarter==p&&(o=this.checkOverlappingReal(l,r[i],p))&&(i=s)}}else{for(i=n-1;0<=i;i--){r[i].labelQuarter==p&&(o=this.checkOverlappingReal(l,r[i],p))&&(i=0)}}!0===o&&100>j&&(o=l.ty+3*l.iy,l.ty=o,g.translate(l.tx2,o),l.hitRect&&(g=g.getBBox(),l.hitRect.translate(l.tx2+g.x,o+g.y)),this.checkOverlapping(n,l,p,q,j+1))}},checkOverlappingReal:function(j,i,l){var a=!1,g=j.label,k=i.label;j.labelQuarter!=l||j.hidden||i.hidden||!k||(g=g.getBBox(),l={},l.width=g.width,l.height=g.height,l.y=j.ty,l.x=j.tx,j=k.getBBox(),k={},k.width=j.width,k.height=j.height,k.y=i.ty,k.x=i.tx,AmCharts.hitTest(l,k)&&(a=!0));
return a}});